<!DOCTYPE html>
<html lang="en">
    <head>
        <title>RoomLayout</title>
        <meta charset="utf-8" />
        <meta
            name="generator"
            content="Three.js Editor"
        />
        <meta
            name="viewport"
            content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
        />
        <style>
            body {
            	font-family: sans-serif;
            	font-size: 11px;
            	background-color: #000;
            	margin: 0px;
            }
            canvas {
            	display: block;
            }
        </style>
    </head>
    <body ontouchstart="">
        <script src="src/Utility.js" type="text/javascript"></script>
        <script src="src/Delegate.js" type="text/javascript"></script>
        <script src="src/Input.js" type="text/javascript"></script>
        <script src="js/app.js" type="text/javascript"></script>
        <script src="js/three.module.js" type="text/javascript"></script>
        <script src="src/Controller.js" type="text/javascript"></script>
        <script type="module">

            var loader = new FileLoader();
			var player = new APP.Player();

            loader.load( 'app.json', function ( text ) {

            	player.load( JSON.parse( text ) );
            	player.setSize( window.innerWidth, window.innerHeight );
            	player.play();
            	document.body.appendChild( player.dom );
                player.dom.firstChild.id = "cvsDisplay";

            	window.addEventListener( 'resize', function () {

            		player.setSize( window.innerWidth, window.innerHeight );

            	} );
                
                loader.load( 'scene.json', function ( text ) {
                    var objloader = new ObjectLoader();
                    player.setScene(objloader.parse( JSON.parse(  text) ));
            
                    var input = new Input();
                    window.input = input;
                    window.onkeydown=input.processKeyDown.bind(input);
                    window.onmousedown=input.processMouseDown.bind(input);
                    window.onmousemove=input.processMouseMove.bind(input);
                    window.onmouseup=input.processMouseUp.bind(input);

                    var controller = new Controller(player.camera, player.scene);
                    window.controller = controller;
                    input.key.down.add(controller.processInput.bind(controller));
                    input.mouse.down.add(controller.processMouseDown.bind(controller));
                    input.mouse.move.add(controller.processMouseMove.bind(controller));
                    input.mouse.up.add(controller.processMouseUp.bind(controller));

                });
            } );
        </script>        
    </body>
</html>
